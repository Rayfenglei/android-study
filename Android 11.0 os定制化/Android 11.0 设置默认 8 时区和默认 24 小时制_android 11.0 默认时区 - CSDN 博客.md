> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/baidu_41666295/article/details/128139125)

**目录**

[1. 概述](#1.%E6%A6%82%E8%BF%B0)

[2. 设置默认 8 时区和默认 24 小时制的核心类](#t1)

[3. 设置默认 8 时区和默认 24 小时制的核心功能分析和实现](#t2)

 [3.1 关于设置默认时区的功能实现](#t3)

[3.2 关于默认 24 小时的功能实现](#t4)

 [3.2.1 在 SettingsProvider 的 defaults.xml 中添加 24 小时的系统属性值](#t5)

[3.2.2 在 DatabaseHelper.java 中设置默认时间属性](#t6)

1. 概述
-----

  在系统产品开发中，有些产品默认时区为 0 时区，而小时制默认为 12 小时，由于产品需求需要要求把时区默认为北京时间，小时制默认为 24 小时，所以就需要设置默认时区为东八区和默认为 24 小时

2. 设置默认 8 时区和默认 24 小时制的核心类
--------------------------

```
build/make/tools/buildinfo_common.sh
framework/base/packages/apps/SettingsProvider/res/values/defaults.xml
framework/base/packages/apps/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java 	
```

3. 设置默认 8 时区和默认 24 小时制的核心功能分析和实现
--------------------------------

  3.1 关于设置默认时区的功能实现
-------------------

 由于 android 默认时区 为 [GMT](https://so.csdn.net/so/search?q=GMT&spm=1001.2101.3001.7020) 0 时区，所以要默认设置为北京时间，就需要设置时区为  
persist.sys.[timezone](https://so.csdn.net/so/search?q=timezone&spm=1001.2101.3001.7020)=Asia/Shanghai 设置时区为东八区 就可以设置为北京时间  
也就是说设置 persist.sys.timezone 时区属性为 Asia/Shanghai 就可以了  
接下来在 buildinfo_common.sh 中添加时区属性 persist.sys.timezone

```
#!/bin/bash
 
 partition="$1"
 
 if [ "$#" -ne 1 ]; then
   echo "Usage: $0 <partition>" 1>&2
   exit 1
 fi
 
 echo "# begin common build properties"
 echo "# autogenerated by $0"
 
 echo "ro.${partition}.build.date=`$DATE`"
 echo "ro.${partition}.build.date.utc=`$DATE +%s`"
 echo "ro.${partition}.build.fingerprint=$BUILD_FINGERPRINT"
 echo "ro.${partition}.build.id=$BUILD_ID"
 echo "ro.${partition}.build.tags=$BUILD_VERSION_TAGS"
 echo "ro.${partition}.build.type=$TARGET_BUILD_TYPE"
 echo "ro.${partition}.build.version.incremental=$BUILD_NUMBER"
 echo "ro.${partition}.build.version.release=$PLATFORM_VERSION_LAST_STABLE"
 echo "ro.${partition}.build.version.release_or_code
 echo "ro.${partition}.build.version.sdk=$PLATFORM_SDK_VERSION"
 
 echo "ro.product.${partition}.brand=$PRODUCT_BRAND"
 echo "ro.product.${partition}.device=$PRODUCT_DEVICE"
 echo "ro.product.${partition}.manufacturer=$PRODUCT_MANUFACTURER"
 echo "ro.product.${partition}.model=$PRODUCT_MODEL"
 echo "ro.product.${partition}.
+ echo "persist.sys.timezone=Asia/Shanghai"
 echo "# end common build properties"
```

3.2 关于默认 24 小时的功能实现
-------------------

 在 android 原生系统中，关于时区的系统属性值 就是 Settings.System.TIME_12_24  
通过设置默认值 就可以实现默认 24 小时 ，那么就需要在 SettingsProvider 中，设置  
系统关于时间的默认属性就可以了

 3.2.1 在 SettingsProvider 的 defaults.xml 中添加 24 小时的系统属性值
--------------------------------------------------------

```
   <resources>
     <bool >true</bool>
     <integer >300000</integer>
     <integer >-1</integer>
     <bool >false</bool>
     <bool >false</bool>
     <!-- Comma-separated list of bluetooth, wifi, and cell. -->
     <string >cell,bluetooth,wifi,nfc,wimax</string>
     <string >bluetooth,wifi,nfc</string>
     <string >0</string>
     <bool >true</bool>
     <bool >true</bool>
    + <string >24</string>
     <bool >false</bool>
     <!-- Default screen brightness, from 0 to 255.  102 is 40%. -->
     <integer >102</integer>
     <bool >false</bool>
     <fraction >100%</fraction>
     <fraction >100%</fraction>
     <bool >true</bool>
     <integer >1</integer>
     <bool >false</bool>
     <bool >false</bool>
     <bool >false</bool>
     <!-- 0 == off, 3 == on -->
     <integer >3</integer>
     <bool >true</bool>
     <bool >true</bool>
     <bool >true</bool>
     <bool >false</bool>
     <!-- 0 == never, 1 == only when plugged in, 2 == always -->
     <integer >2</integer>
     <bool >true</bool>
     <bool >true</bool>
	 ...
 </resources>
```

通过 defaults.xml 的上述代码发现添加 <string >24</string>  
为来表示时间模式为 24 小时制，然后在 DatabaseHelper.java 中加载这一默认系统属性就可以了

3.2.2 在 DatabaseHelper.java 中设置默认时间属性
-------------------------------------

```
  private void loadSystemSettings(SQLiteDatabase db) {
         SQLiteStatement stmt = null;
         try {
             stmt = db.compileStatement("INSERT OR IGNORE INTO system(name,value)"
                     + " VALUES(?,?);");
 
             loadBooleanSetting(stmt, Settings.System.DIM_SCREEN,
                     R.bool.def_dim_screen);
             loadIntegerSetting(stmt, Settings.System.SCREEN_OFF_TIMEOUT,
                     R.integer.def_screen_off_timeout);
 
             // Set default cdma DTMF type
             loadSetting(stmt, Settings.System.DTMF_TONE_TYPE_WHEN_DIALING, 0);
       +      loadStringSetting(stmt, Settings.System.TIME_12_24, R.string.def_time_12_24);
             // Set default hearing aid
             loadSetting(stmt, Settings.System.HEARING_AID, 0);
 
             // Set default tty mode
             loadSetting(stmt, Settings.System.TTY_MODE, 0);
 
             loadIntegerSetting(stmt, Settings.System.SCREEN_BRIGHTNESS,
                     R.integer.def_screen_brightness);
 
             loadIntegerSetting(stmt, Settings.System.SCREEN_BRIGHTNESS_FOR_VR,
                     com.android.internal.R.integer.config_screenBrightnessForVrSettingDefault);
 
             loadBooleanSetting(stmt, Settings.System.SCREEN_BRIGHTNESS_MODE,
                     R.bool.def_screen_brightness_automatic_mode);
 
             loadBooleanSetting(stmt, Settings.System.ACCELEROMETER_ROTATION,
                     R.bool.def_accelerometer_rotation);
 
             loadDefaultHapticSettings(stmt);
 
             loadBooleanSetting(stmt, Settings.System.NOTIFICATION_LIGHT_PULSE,
                     R.bool.def_notification_pulse);
 
             loadUISoundEffectsSettings(stmt);
 
             loadIntegerSetting(stmt, Settings.System.POINTER_SPEED,
                     R.integer.def_pointer_speed);
             loadIntegerSetting(stmt, Settings.System.SHOW_BATTERY_PERCENT, R.integer.def_show_battery_percent);
             /// M: Load MTK added System providers before Android M.
             mUtils.loadCustomSystemSettings(stmt);
 
             /*
              * IMPORTANT: Do not add any more upgrade steps here as the global,
              * secure, and system settings are no longer stored in a database
              * but are kept in memory and persisted to XML.
              *
              * See: SettingsProvider.UpgradeController#onUpgradeLocked
              */
         } finally {
             if (stmt != null) stmt.close();
         }
```

在 DatabaseHelper.java 上述代码中可以看出通过在 loadSystemSettings 中添加加载默认时间的属性  
loadStringSetting(stmt, Settings.System.TIME_12_24, R.string.def_time_12_24); 设置  
系统时间为默认 24 小时，来实现功能